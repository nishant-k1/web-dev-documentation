# Commit Phase

The **commit phase** is where React applies the changes that the render phase (reconciliation) already calculated. See **12. Render Phase** for what happens before commit.

---

## What is the commit phase?

**Commit phase** = applying the changes that reconciliation already calculated.

This is where:

- DOM nodes are inserted, updated, or removed
- useLayoutEffect cleanup and callbacks run
- Browser paints (user sees the update)
- useEffect cleanup and callbacks run (after paint, asynchronously)

Real DOM mutation happens here. No diffing or reconciliation — just applying the work.

**Properties of the commit phase:**

- It is synchronous
- It cannot be paused
- It must complete once started
- It is usually very fast

**Why separation exists:** Render phase → pure and interruptible. Commit phase → fast and deterministic. This separation is what allows concurrent rendering.

---

## Full timeline (render → commit)

```text
Render Phase (see 12. Render Phase)
  - Build work-in-progress Fiber tree
  - Compare with current Fiber tree
  - Mark updates

Commit Phase
  - Before Mutation (internal bookkeeping)
  - Mutation: insert/update/remove DOM nodes, update text content
  - Layout effects: useLayoutEffect cleanup, then useLayoutEffect callbacks
  - Browser paints (user sees update)
  - Passive effects: useEffect cleanup, then useEffect callbacks
```

---

## Commit phase in more detail

1. **Before Mutation** — React prepares to apply changes (mostly internal bookkeeping).
2. **Mutation** — The real DOM is updated (insert, update, remove nodes). The real DOM now matches the work-in-progress Fiber tree. **Still not painted yet.**
3. **Layout effects** — useLayoutEffect cleanup runs, then useLayoutEffect callbacks run. This happens after DOM update, before browser paint, synchronously. You can safely measure layout here.
4. **Paint** — The browser renders pixels; the user sees the update. (Painting is done by the browser, not React. See **14. Painting**.)
5. **Passive effects** — useEffect cleanup runs, then useEffect callbacks run. This is asynchronous and non-blocking.

---

## When does the user see changes?

- **Render phase** — User sees nothing new.
- **Commit phase** — The user sees changes **during** this phase, specifically after DOM mutation and paint. So the commit phase is partly before paint and partly after paint.

Correct mental model: React has two major phases — **render phase** (calculation) and **commit phase** (apply changes and run effects). The user sees updates during the commit phase, after the browser paints.

---

## Is “Commit Phase” mentioned in React docs?

React’s current docs (react.dev) don’t emphasize the term “Commit Phase,” but the concept is real. It appears in legacy docs, RFCs, and source code (e.g. `commitRoot`, `commitMutationEffects`, `commitLayoutEffects`, `commitPassiveEffects`). Docs often say “after React updates the DOM” or “after the screen updates” instead of naming the phase.

---

## Summary

- **Commit phase** = apply changes to the real DOM and run effects; user sees updates after paint.
- Reconciliation (render phase) calculates changes; commit applies them.
