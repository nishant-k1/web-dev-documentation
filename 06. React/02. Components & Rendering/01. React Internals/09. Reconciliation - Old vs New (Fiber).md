# Reconciliation: Old vs New (Fiber)

React’s reconciliation evolved from a **stack-based, synchronous** model (pre–React 16) to the **Fiber** architecture (React 16+). The goal (compare previous and next UI, then update the real DOM) is the same; the implementation and capabilities changed.

---

## 1. Old Reconciliation (Before React 16)

**Conceptual model:**

- Old vDOM tree  
- New vDOM tree  
- Diff them  
- Update real DOM  

**How it worked:**

- React built a new virtual DOM tree.
- Compared it with the previous virtual DOM tree.
- Computed differences.
- Applied changes to the real DOM.

**Characteristics:**

- Entire render was **synchronous**.
- Could **not** pause or prioritize.
- Large updates could **block the main thread**.
- No concurrent rendering — the browser could freeze during big updates.

---

## 2. New Reconciliation (Fiber – React 16+)

React still does reconciliation, but the internal model changed.

**Old mental model (conceptually correct):**  
New vDOM → diff with old vDOM → patch real DOM.

**What actually happens now:**

- React keeps a **current Fiber tree** (what’s on screen).
- During the **render phase**, it builds a **work-in-progress Fiber tree**.
- While building, it **compares** with the current tree and **marks** what needs to change (effect flags).
- In the **commit phase**, it applies those marked changes to the real DOM.

So instead of “old vDOM vs new vDOM” as two plain trees, it’s:

**Current Fiber tree ↔ Work-in-progress Fiber tree**

Reconciliation was **not** removed; it was **reimplemented** using Fiber.

---

## 3. What Is Fiber?

Fiber is a **node-based data structure** that represents each component or DOM element in the tree.

Each Fiber node holds things like:

- Type, props, state  
- Hook data  
- Effect tags  
- Child / sibling / return (parent) references  

It replaces the old “simple virtual DOM object” with a structure that supports **incremental work**, **scheduling**, and **prioritization**. So:

- **Fiber is the modern virtual DOM** — same idea (in-memory representation of UI before touching the real DOM), more capable implementation.
- Diffing still happens during the render phase (element type, keys, props → reuse / update / delete / insert).
- The **concept** of reconciliation is unchanged; the **engine** was redesigned.

---

## 4. Flow: Old vs New

**Old model:**  
Calculate everything → diff everything → update everything (all in one blocking pass).

**Modern Fiber model:**

```text
Build work-in-progress Fiber tree
    ↓
Compare with current Fiber tree
    ↓
Mark updates (effect flags)
    ↓
Commit phase: apply changes to real DOM
```

- Work can be **paused and resumed**.
- Updates can be **prioritized** (e.g. user input over background work).
- **Concurrent rendering** (React 18+) builds on this.

---

## 5. Comparison Table

| Feature              | Old Reconciliation     | New (Fiber) Reconciliation |
| -------------------- | --------------------- | -------------------------- |
| Execution            | Fully synchronous     | Interruptible              |
| Scheduling           | None                  | Priority-based             |
| Pausing              | ❌ Cannot pause       | ✅ Can pause               |
| Concurrent Rendering | ❌ No                 | ✅ Yes                     |
| Structure            | Simple vDOM objects   | Fiber linked nodes         |
| Commit separation    | Less structured       | Clear render vs commit     |

---

## 6. Why Fiber Was Introduced

- Large trees had to be fully processed before yielding to the browser → **frame drops** and jank.
- Fiber adds **time slicing**, **priority scheduling**, **pause/resume**, and a clear **render vs commit** split so the UI stays responsive.

---

## 7. What Did NOT Change

- The **idea** of reconciliation (compare previous and next UI, minimal updates) still exists.
- **Keys** still matter for list identity and reordering.
- **Diffing** still happens (during render, between the two Fiber trees).
- The **real DOM** is still updated only in the **commit phase**.

Only the **engine** (stack → Fiber) was redesigned.

---

## 8. Summary

- **Old reconciliation** = correct concept (diff two trees, patch DOM), but synchronous and blocking.
- **Fiber reconciliation** = same concept, reimplemented with Fiber: interruptible, schedulable, and the basis for concurrent rendering.
