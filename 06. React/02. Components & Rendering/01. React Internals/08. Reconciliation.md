# Reconciliation

- Updating the real DOM is **NOT** part of the render phase or reconciliation. It is part of the **commit phase**.
- **Reconciliation** is the process where React compares the previous Virtual DOM (or Fiber tree) with the new one (after state, prop, or context changes) to figure out the **minimal set of changes** required to update the real DOM.
- Reconciliation only comes into play during **subsequent renders** when React has something to compare. It does **not** take place on the first render.

---

## 1. First Render vs Subsequent Renders

### First Render (No Previous Tree)

- When you first load a React app, React processes the entire component tree from the root.
- On the first render, there is **no prior tree** to compare with.
- React creates the initial Virtual DOM / Fiber tree from your JSX, then converts it to real DOM and attaches it to the browser (e.g. `#root`).
- **No reconciliation** — no diffing, because there was no previous render.

### Subsequent Renders (Reconciliation Happens)

- On later renders, React has an existing tree from the previous render.
- React compares the new tree with the old one (reconciliation) to determine the minimal updates needed for the real DOM.
- Only the parts that changed are updated.

**Key takeaway:** First render = no reconciliation. Subsequent renders = reconciliation to update only what changed.

---

## 2. First Render: How the Real DOM Is Created

1. **Initialization** — React starts and processes the component tree. JSX is converted into a Virtual DOM / Fiber tree (in-memory representation of the UI).
2. **Rendering the tree** — React takes that tree and generates the corresponding real DOM nodes (no comparison step).
3. **ReactDOM’s role** — `ReactDOM.render()` / `createRoot().render()` walks the tree, creates actual HTML elements, and appends them to the root (e.g. `#root`).
4. **Browser** — The browser then styles and paints the real DOM.

---

## 3. Single Tree for the Whole App

In React, there is **one shared tree** for the entire app (whether we call it Virtual DOM or Fiber tree). There are not separate independent trees per component.

- Each component contributes to the same tree; component output is merged into one tree-like structure.
- When state or props change, reconciliation runs over this **whole tree**, but only the **changed parts** of the real DOM are updated.

Breakdown:

- **Component render** → JSX becomes React elements.
- **React elements** → Form nodes in the tree (vDOM / Fiber).
- **Single tree** → All components’ output lives in one unified tree.
- **Reconciliation** → Compare new tree with previous tree; update only the parts of the real DOM that need to change.

![alt text](image.png)

---

## 4. Example: What Actually Happens During Re-render

Component with `title` and `description` state; a button updates only `title`:

```javascript
function MyExampleComponent() {
  const [title, setTitle] = React.useState("This is old title");
  const [description, setDescription] = React.useState("This is the old description");
  const handleTitleUpdate = () => {
    setTitle("This is new title.");
  };
  return (
    <div>
      <h1>{title}</h1>
      <p>{description}</p>
      <button onClick={handleTitleUpdate}>Update</button>
    </div>
  );
}
```

When the button is clicked:

1. **State updates** → Re-render is triggered.
2. **New tree** → A new Virtual DOM / Fiber tree is created for the component (and its place in the full tree).
3. **Reconciliation** — React compares the old and new trees:
   - `<div>` — same → no change in real DOM.
   - `<h1>` — text content changed ("This is old title" → "This is new title.").
   - `<p>` and `<button>` — unchanged → no touch.
4. **Real DOM update** — React does **not** remove and re-insert the `<h1>`. It **updates only the text content** of the existing `<h1>`. The `<div>`, `<p>`, and `<button>` are left as they are.

**Summary:** Only the changed part (the text inside `<h1>`) is updated in the real DOM. React’s reconciliation ensures minimal updates instead of re-creating the whole subtree.
