# Base64URL vs Blob URL

Understanding the difference between Base64URL encoding and Blob URLs - two completely different concepts often confused.

---

## Core Concept

**Base64URL** and **Blob URL** are fundamentally different:

- **Base64URL** - An **encoding format** (how data is represented as text)
- **Blob URL** - A **browser API** (how to reference in-memory binary data)

They serve different purposes and are used in different contexts.

---

## Base64URL

### What is Base64URL?

**Base64URL** is a **text encoding scheme** - a way to represent binary data as text using only URL-safe characters.

**Characteristics:**

- ✅ **Encoding format** - Converts binary → text
- ✅ **URL-safe** - Uses characters safe for URLs (no `+`, `/`, `=`)
- ✅ **Reversible** - Can decode back to original data
- ✅ **Text representation** - Data is embedded as text string

---

### Base64URL Format

**Standard Base64:**

```
dGVzdCBkYXRh  (uses +, /, =)
```

**Base64URL (URL-safe):**

```
dGVzdCBkYXRh  (uses -, _, no padding)
```

**Differences:**

- `+` → `-`
- `/` → `_`
- `=` (padding) → removed or replaced

---

### Where Base64URL is Used

**1. JWT Tokens:**

```javascript
// JWT structure: header.payload.signature
// Each part is Base64URL encoded

const header = {
  alg: "HS256",
  typ: "JWT",
};

// Base64URL encoded
const encodedHeader = btoa(JSON.stringify(header))
  .replace(/\+/g, "-")
  .replace(/\//g, "_")
  .replace(/=/g, "");

// Result: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9
```

**2. Data URLs:**

```javascript
// Base64URL encoded image in data URL
const dataUrl = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...";

// Used in img src
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA..." />;
```

**3. URL Parameters:**

```javascript
// Base64URL encoded data in URL
const encoded = btoa(JSON.stringify({ userId: 123 }))
  .replace(/\+/g, "-")
  .replace(/\//g, "_");

const url = `https://example.com/api?data=${encoded}`;
```

---

### Base64URL Encoding/Decoding

**Encoding:**

```javascript
function base64UrlEncode(str) {
  return btoa(str).replace(/\+/g, "-").replace(/\//g, "_").replace(/=/g, "");
}

const encoded = base64UrlEncode("Hello World");
// Result: "SGVsbG8gV29ybGQ"
```

**Decoding:**

```javascript
function base64UrlDecode(str) {
  // Add padding if needed
  str = str.replace(/-/g, "+").replace(/_/g, "/");
  while (str.length % 4) {
    str += "=";
  }
  return atob(str);
}

const decoded = base64UrlDecode("SGVsbG8gV29ybGQ");
// Result: "Hello World"
```

---

## Blob URL

### What is Blob URL?

**Blob URL** (Object URL) is a **browser API** that creates temporary URLs pointing to Blob objects stored in browser memory.

**Characteristics:**

- ✅ **Browser API** - `URL.createObjectURL()`
- ✅ **Temporary URL** - Points to in-memory data
- ✅ **Memory reference** - References RAM, not disk
- ✅ **Revocable** - Can be revoked with `URL.revokeObjectURL()`

---

### Blob URL Format

**Format:**

```
blob:http://localhost:3000/8d2d1cda-9273-41a7-9f44-b5ae0d5e4b8f
│    │                        │
│    │                        └─ Unique ID
│    └─ Origin
└─ Protocol
```

**Example:**

```
blob:http://localhost:3000/8d2d1cda-9273-41a7-9f44-b5ae0d5e4b8f
blob:https://example.com/550e8400-e29b-41d4-a716-446655440000
```

---

### Where Blob URL is Used

**1. File Previews:**

```javascript
// Create blob from file
const file = document.getElementById("fileInput").files[0];
const blobUrl = URL.createObjectURL(file);

// Use in img tag
const img = document.createElement("img");
img.src = blobUrl; // blob:http://localhost:3000/...

// Clean up when done
URL.revokeObjectURL(blobUrl);
```

**2. File Downloads:**

```javascript
// Download file from blob
const blob = new Blob(["File content"], { type: "text/plain" });
const blobUrl = URL.createObjectURL(blob);

const a = document.createElement("a");
a.href = blobUrl;
a.download = "file.txt";
a.click();

URL.revokeObjectURL(blobUrl);
```

**3. Video/Audio Playback:**

```javascript
// Play video from blob
const videoBlob = await fetch("/api/video").then((r) => r.blob());
const blobUrl = URL.createObjectURL(videoBlob);

const video = document.createElement("video");
video.src = blobUrl;
video.play();
```

---

### Blob URL Creation

**Creating Blob URL:**

```javascript
// From File object
const file = input.files[0];
const blobUrl = URL.createObjectURL(file);

// From Blob object
const blob = new Blob(["Hello"], { type: "text/plain" });
const blobUrl = URL.createObjectURL(blob);

// From ArrayBuffer
const buffer = new ArrayBuffer(8);
const blob = new Blob([buffer]);
const blobUrl = URL.createObjectURL(blob);
```

**Revoking Blob URL:**

```javascript
// Always revoke when done
URL.revokeObjectURL(blobUrl);

// After revocation, URL is invalid
// Accessing it will fail
```

---

## Key Differences

### Comparison Table

| Aspect          | Base64URL                 | Blob URL                      |
| --------------- | ------------------------- | ----------------------------- |
| **Type**        | Encoding format           | Browser API                   |
| **Purpose**     | Represent data as text    | Reference in-memory data      |
| **Format**      | Text string               | `blob:http://...` URL         |
| **Storage**     | Embedded in code/URL      | Points to RAM                 |
| **Size**        | ~33% larger than original | Just a reference (tiny)       |
| **Reversible**  | Yes (decode)              | No (just a pointer)           |
| **Use Case**    | JWT, data URLs, encoding  | File previews, downloads      |
| **Browser API** | No (just encoding)        | Yes (`URL.createObjectURL()`) |
| **Memory**      | Data is in the string     | Data is in RAM                |
| **Cleanup**     | No cleanup needed         | Must revoke                   |

---

### Visual Comparison

**Base64URL:**

```
Data → Base64URL Encoding → Text String
"Hello" → "SGVsbG8=" → Embedded in code/URL
```

**Blob URL:**

```
Data → Blob Object → Blob URL → Reference
"Hello" → Blob → blob:http://... → Points to RAM
```

---

## Use Cases

### When to Use Base64URL

**✅ Use Base64URL for:**

1. **JWT Tokens:**

   ```javascript
   // JWT parts are Base64URL encoded
   const token =
     "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEyM30.signature";
   ```

2. **Data URLs (Small Files):**

   ```javascript
   // Small images/icons embedded in HTML/CSS
   <img src="data:image/png;base64,iVBORw0KGgo..." />
   ```

3. **URL Parameters:**

   ```javascript
   // Encoding data for URL parameters
   const encoded = base64UrlEncode(JSON.stringify(data));
   const url = `https://api.com/data?payload=${encoded}`;
   ```

4. **API Responses (Text Format):**
   ```javascript
   // When API returns Base64URL encoded data
   const response = { image: "iVBORw0KGgo..." };
   ```

---

### When to Use Blob URL

**✅ Use Blob URL for:**

1. **File Previews:**

   ```javascript
   // Preview uploaded file before upload
   const blobUrl = URL.createObjectURL(file);
   img.src = blobUrl;
   ```

2. **Large Files:**

   ```javascript
   // Large files (videos, PDFs) - more efficient than Base64
   const blobUrl = URL.createObjectURL(largeFile);
   video.src = blobUrl;
   ```

3. **File Downloads:**

   ```javascript
   // Download files created in browser
   const blob = new Blob([data], { type: "application/pdf" });
   const blobUrl = URL.createObjectURL(blob);
   a.href = blobUrl;
   a.download = "file.pdf";
   ```

4. **Memory-Efficient Handling:**
   ```javascript
   // When you need to work with binary data without encoding overhead
   const blobUrl = URL.createObjectURL(binaryData);
   ```

---

## Size Comparison

### Base64URL Size

**Base64 encoding increases size by ~33%:**

```
Original: "Hello World" (11 bytes)
Base64: "SGVsbG8gV29ybGQ=" (16 bytes)
Increase: ~45% larger
```

**For images:**

```
Original image: 100 KB
Base64 encoded: ~133 KB (33% larger)
```

---

### Blob URL Size

**Blob URL is just a reference:**

```
Blob URL: "blob:http://localhost:3000/abc-123" (~50 bytes)
Actual data: Still in RAM (original size)
```

**No size increase** - URL is just a pointer to memory.

---

## Examples

### Example 1: Image Display

**Using Base64URL (Data URL):**

```javascript
// Small icon - embed directly
const iconBase64 = "iVBORw0KGgoAAAANSUhEUgAA...";
const dataUrl = `data:image/png;base64,${iconBase64}`;

<img src={dataUrl} />;
```

**Using Blob URL:**

```javascript
// Large image - use blob URL
const file = input.files[0];
const blobUrl = URL.createObjectURL(file);

<img src={blobUrl} />;

// Clean up
URL.revokeObjectURL(blobUrl);
```

---

### Example 2: JWT Token

**JWT uses Base64URL (not Blob URL):**

```javascript
// JWT structure
const header = { alg: "HS256", typ: "JWT" };
const payload = { userId: 123 };

// Base64URL encode each part
const encodedHeader = base64UrlEncode(JSON.stringify(header));
const encodedPayload = base64UrlEncode(JSON.stringify(payload));

// JWT token
const token = `${encodedHeader}.${encodedPayload}.${signature}`;
// Result: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEyM30.signature"
```

**This is NOT a Blob URL** - it's Base64URL encoded text.

---

### Example 3: File Upload Preview

**Using Blob URL (Correct):**

```javascript
function previewFile(file) {
  // Create blob URL
  const blobUrl = URL.createObjectURL(file);

  // Display preview
  const img = document.createElement("img");
  img.src = blobUrl;
  document.body.appendChild(img);

  // Clean up when done
  img.onload = () => {
    URL.revokeObjectURL(blobUrl);
  };
}
```

**Using Base64URL (Alternative but less efficient):**

```javascript
function previewFile(file) {
  const reader = new FileReader();

  reader.onload = (e) => {
    // Base64URL data URL
    const dataUrl = e.target.result; // data:image/png;base64,...
    const img = document.createElement("img");
    img.src = dataUrl;
    document.body.appendChild(img);
  };

  reader.readAsDataURL(file); // Converts to Base64URL
}
```

---

## Common Confusions

### Confusion 1: "Is JWT a Blob URL?"

**No!** JWT uses Base64URL encoding, not Blob URLs.

```javascript
// JWT token (Base64URL encoded text)
const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...";

// This is NOT a blob URL
// It's Base64URL encoded JSON
```

---

### Confusion 2: "Can I use Base64URL for file downloads?"

**Yes, but inefficient:**

```javascript
// Base64URL (works but inefficient)
const base64 = "SGVsbG8gV29ybGQ=";
const dataUrl = `data:text/plain;base64,${base64}`;
a.href = dataUrl; // Works but larger file size

// Blob URL (better)
const blob = new Blob(["Hello World"], { type: "text/plain" });
const blobUrl = URL.createObjectURL(blob);
a.href = blobUrl; // More efficient
```

---

### Confusion 3: "Are they interchangeable?"

**No!** They serve different purposes:

- **Base64URL** - Encoding format (data representation)
- **Blob URL** - Browser API (memory reference)

You can convert between them, but they're not the same thing.

---

## Conversion Between Them

### Base64URL → Blob URL

```javascript
// Start with Base64URL string
const base64 = "SGVsbG8gV29ybGQ=";

// Decode to binary
const binary = atob(base64);

// Create Blob
const blob = new Blob([binary], { type: "text/plain" });

// Create Blob URL
const blobUrl = URL.createObjectURL(blob);
```

---

### Blob URL → Base64URL

```javascript
// Start with Blob URL
const blobUrl = "blob:http://localhost:3000/abc-123";

// Fetch blob data
const blob = await fetch(blobUrl).then((r) => r.blob());

// Convert to Base64URL
const reader = new FileReader();
reader.onload = () => {
  const base64 = reader.result; // data:...;base64,...
  const base64Data = base64.split(",")[1]; // Just the Base64 part
};
reader.readAsDataURL(blob);
```

---

## Best Practices

### Base64URL Best Practices

**✅ Use for:**

- Small files (< 100KB)
- JWT tokens
- Data URLs in HTML/CSS
- URL parameters

**❌ Avoid for:**

- Large files (inefficient, ~33% size increase)
- Binary data in memory (use Blob instead)

---

### Blob URL Best Practices

**✅ Use for:**

- File previews
- Large files
- Memory-efficient handling
- File downloads

**✅ Always:**

- Revoke when done: `URL.revokeObjectURL(blobUrl)`
- Clean up on component unmount
- Handle errors if URL is revoked

**❌ Avoid:**

- Storing blob URLs (they're temporary)
- Sharing blob URLs across tabs (they're origin-specific)

---

## Common Questions

### Q: Can I use Base64URL in img src?

**A:** Yes, as a data URL: `data:image/png;base64,...`

### Q: Can I use Blob URL in img src?

**A:** Yes: `blob:http://localhost:3000/...`

### Q: Which is better for images?

**A:**

- **Small images (< 100KB):** Base64URL (data URL) - simpler
- **Large images:** Blob URL - more efficient

### Q: Are JWT tokens Blob URLs?

**A:** No! JWT tokens use Base64URL encoding, not Blob URLs.

### Q: Can I store Base64URL in localStorage?

**A:** Yes, it's just a string. But be aware of size limits (~5-10MB).

### Q: Can I store Blob URL in localStorage?

**A:** Yes, but it's temporary and origin-specific. Better to store the blob data itself.

---

## Related Topics

- [Blob URLs and Memory Management](./14.%20Blob%20URLs%20and%20Memory%20Management.md) - Blob URL details
- [JWT Authentication Workflow](../../6.%20API%20Integration/2.%20Authentication%20&%20Authorization/1.%20JWT%20Authentication%20Workflow.md) - Base64URL in JWTs
- [Response Handling](../../6.%20API%20Integration/1.%20HTTP/11.%20Response%20Handling.md) - Blob responses

---

## Summary

**Base64URL:**

- ✅ Encoding format (binary → text)
- ✅ Used in JWTs, data URLs
- ✅ ~33% size increase
- ✅ Reversible (decode)

**Blob URL:**

- ✅ Browser API (`URL.createObjectURL()`)
- ✅ Temporary URL pointing to RAM
- ✅ No size increase (just reference)
- ✅ Must revoke when done

**Key Differences:**

- **Base64URL** = How data is encoded (text representation)
- **Blob URL** = How to reference data (memory pointer)

**Use Cases:**

- **Base64URL:** JWT tokens, small data URLs, URL parameters
- **Blob URL:** File previews, large files, memory-efficient handling

**Key Takeaway:** Base64URL is an encoding format for representing data as text. Blob URL is a browser API for creating temporary URLs that reference in-memory binary data. They're completely different concepts used for different purposes.
