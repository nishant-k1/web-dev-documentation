# HTTP Status Codes

Understanding HTTP status codes - what they mean and how to handle them.

---

## Core Concept

**HTTP status codes** are 3-digit numbers that indicate the result of an HTTP request.

**Status Code Ranges:**

- **1xx** - Informational
- **2xx** - Success
- **3xx** - Redirection
- **4xx** - Client Error
- **5xx** - Server Error

---

## 2xx Success Codes

### 200 OK

**Meaning:** Request succeeded.

**When to use:**

- Successful GET request
- Successful PUT/PATCH request
- Default success response

**Example:**

```javascript
fetch("/api/users/123").then((res) => {
  if (res.status === 200) {
    return res.json();
  }
});
```

---

### 201 Created

**Meaning:** Resource was successfully created.

**When to use:**

- Successful POST request (new resource created)
- Resource creation endpoint

**Example:**

```javascript
fetch("/api/users", {
  method: "POST",
  body: JSON.stringify({ name: "John" }),
}).then((res) => {
  if (res.status === 201) {
    console.log("User created!");
    return res.json();
  }
});
```

**Response should include:**

- `Location` header with URL of created resource
- Body with created resource data

---

### 204 No Content

**Meaning:** Request succeeded, but no content to return.

**When to use:**

- Successful DELETE request
- Successful PUT/PATCH (no response body needed)
- Update operations that don't return data

**Example:**

```javascript
fetch("/api/users/123", {
  method: "DELETE",
}).then((res) => {
  if (res.status === 204) {
    console.log("User deleted");
    // No response body
  }
});
```

---

### Other 2xx Codes

**202 Accepted:**

- Request accepted but not yet processed
- Used for async operations

**206 Partial Content:**

- Partial content returned
- Used for range requests (video streaming)

---

## 3xx Redirection Codes

### 301 Moved Permanently

**Meaning:** Resource has permanently moved to new URL.

**When to use:**

- Permanent URL change
- SEO redirects

**Example:**

```javascript
// Browser automatically follows redirect
fetch("/old-url").then((res) => {
  if (res.status === 301) {
    console.log("Redirected to:", res.headers.get("Location"));
  }
});
```

---

### 302 Found (Temporary Redirect)

**Meaning:** Resource temporarily moved to new URL.

**When to use:**

- Temporary URL change
- Login redirects

---

### 304 Not Modified

**Meaning:** Resource hasn't changed since last request.

**When to use:**

- Caching validation
- Conditional GET requests

**Example:**

```javascript
fetch("/api/users/123", {
  headers: {
    "If-None-Match": etag, // From previous response
  },
}).then((res) => {
  if (res.status === 304) {
    // Use cached version
    console.log("Not modified, use cache");
  }
});
```

---

## 4xx Client Error Codes

### 400 Bad Request

**Meaning:** Request is malformed or invalid.

**When to use:**

- Invalid request syntax
- Missing required fields
- Invalid data format

**How to handle:**

```javascript
fetch("/api/users", {
  method: "POST",
  body: JSON.stringify({ invalid: "data" }),
}).then((res) => {
  if (res.status === 400) {
    return res.json().then((err) => {
      console.error("Bad request:", err.message);
      // Show error to user
    });
  }
});
```

---

### 401 Unauthorized

**Meaning:** Authentication required or failed.

**When to use:**

- Missing authentication token
- Invalid/expired token
- Not authenticated

**How to handle:**

```javascript
fetch("/api/users", {
  headers: {
    Authorization: "Bearer invalid-token",
  },
}).then((res) => {
  if (res.status === 401) {
    // Redirect to login
    window.location.href = "/login";
  }
});
```

---

### 403 Forbidden

**Meaning:** Authenticated but not authorized.

**When to use:**

- User doesn't have permission
- Insufficient privileges
- Access denied

**How to handle:**

```javascript
fetch("/api/admin/users").then((res) => {
  if (res.status === 403) {
    console.error("Access forbidden");
    // Show "You don't have permission" message
  }
});
```

**Difference from 401:**

- **401** - Not authenticated (need to login)
- **403** - Authenticated but not authorized (logged in but no permission)

---

### 404 Not Found

**Meaning:** Resource doesn't exist.

**When to use:**

- Resource not found
- Invalid URL
- Deleted resource

**How to handle:**

```javascript
fetch("/api/users/999").then((res) => {
  if (res.status === 404) {
    console.error("User not found");
    // Show "Not found" message
  }
});
```

---

### 422 Unprocessable Entity

**Meaning:** Request is valid but cannot be processed.

**When to use:**

- Validation errors
- Business logic errors
- Invalid data values

**How to handle:**

```javascript
fetch("/api/users", {
  method: "POST",
  body: JSON.stringify({ email: "invalid-email" }),
}).then((res) => {
  if (res.status === 422) {
    return res.json().then((err) => {
      console.error("Validation errors:", err.errors);
      // Show validation errors to user
    });
  }
});
```

**Common use:** Form validation errors.

---

### Other 4xx Codes

**405 Method Not Allowed:**

- HTTP method not allowed for this endpoint
- Example: POST to GET-only endpoint

**409 Conflict:**

- Resource conflict (duplicate email, etc.)
- Example: Creating user with existing email

**429 Too Many Requests:**

- Rate limit exceeded
- Too many requests in short time

---

## 5xx Server Error Codes

### 500 Internal Server Error

**Meaning:** Server encountered an error.

**When to use:**

- Server-side error
- Unexpected exception
- Database error

**How to handle:**

```javascript
fetch("/api/users").then((res) => {
  if (res.status === 500) {
    console.error("Server error");
    // Show "Something went wrong" message
    // Log error for debugging
  }
});
```

**Note:** Client can't fix this. Server needs to be fixed.

---

### 502 Bad Gateway

**Meaning:** Server acting as gateway received invalid response.

**When to use:**

- Proxy/gateway error
- Upstream server error

---

### 503 Service Unavailable

**Meaning:** Server temporarily unavailable.

**When to use:**

- Server maintenance
- Overloaded server
- Temporary outage

**How to handle:**

```javascript
fetch("/api/users").then((res) => {
  if (res.status === 503) {
    console.error("Service unavailable");
    // Show "Service temporarily unavailable" message
    // Retry after delay
  }
});
```

---

### 504 Gateway Timeout

**Meaning:** Gateway didn't receive response in time.

**When to use:**

- Timeout waiting for upstream server
- Slow upstream server

---

## Status Code Handling

### Basic Handling

```javascript
fetch("/api/users")
  .then((res) => {
    if (res.ok) {
      // 200-299
      return res.json();
    } else if (res.status === 404) {
      throw new Error("Not found");
    } else if (res.status === 500) {
      throw new Error("Server error");
    } else {
      throw new Error(`HTTP error! status: ${res.status}`);
    }
  })
  .catch((error) => {
    console.error("Error:", error);
  });
```

---

### Comprehensive Handler

```javascript
async function handleResponse(response) {
  if (response.ok) {
    return await response.json();
  }

  switch (response.status) {
    case 400:
      const badRequest = await response.json();
      throw new Error(`Bad request: ${badRequest.message}`);

    case 401:
      // Redirect to login
      window.location.href = "/login";
      throw new Error("Unauthorized");

    case 403:
      throw new Error("Forbidden - insufficient permissions");

    case 404:
      throw new Error("Resource not found");

    case 422:
      const validation = await response.json();
      throw new Error(`Validation error: ${validation.errors.join(", ")}`);

    case 500:
      throw new Error("Internal server error");

    case 503:
      throw new Error("Service temporarily unavailable");

    default:
      throw new Error(`HTTP error! status: ${response.status}`);
  }
}

// Usage
fetch("/api/users")
  .then(handleResponse)
  .then((data) => console.log(data))
  .catch((error) => console.error(error));
```

---

## Status Code Ranges Summary

| Range   | Category     | Meaning           | Action           |
| ------- | ------------ | ----------------- | ---------------- |
| **2xx** | Success      | Request succeeded | Process response |
| **3xx** | Redirect     | Resource moved    | Follow redirect  |
| **4xx** | Client Error | Request error     | Fix request      |
| **5xx** | Server Error | Server error      | Retry or report  |

---

## Common Status Codes Quick Reference

| Code    | Meaning               | Common Use                 |
| ------- | --------------------- | -------------------------- |
| **200** | OK                    | Successful GET, PUT, PATCH |
| **201** | Created               | Successful POST            |
| **204** | No Content            | Successful DELETE          |
| **400** | Bad Request           | Invalid request data       |
| **401** | Unauthorized          | Not authenticated          |
| **403** | Forbidden             | Not authorized             |
| **404** | Not Found             | Resource doesn't exist     |
| **422** | Unprocessable Entity  | Validation errors          |
| **500** | Internal Server Error | Server error               |
| **503** | Service Unavailable   | Server overloaded          |

---

## Best Practices

### 1. Use Appropriate Status Codes

```javascript
// ✅ Correct
res.status(201).json({ id: 123, name: "John" }); // Created

// ❌ Wrong
res.status(200).json({ id: 123, name: "John" }); // Should be 201
```

### 2. Include Error Details

```javascript
// ✅ Good - Include error details
res.status(422).json({
  error: "Validation failed",
  errors: {
    email: "Invalid email format",
    age: "Age must be positive",
  },
});

// ❌ Bad - No details
res.status(422).json({ error: "Validation failed" });
```

### 3. Handle All Status Codes

```javascript
// ✅ Good - Handle all cases
if (res.status === 200) {
  // Success
} else if (res.status === 404) {
  // Not found
} else if (res.status >= 500) {
  // Server error
} else {
  // Other errors
}
```

---

## Common Questions

### Q: What's the difference between 401 and 403?

**A:**

- **401 Unauthorized** - Not authenticated (need to login)
- **403 Forbidden** - Authenticated but not authorized (no permission)

### Q: When should I use 422 vs 400?

**A:**

- **400 Bad Request** - Malformed request (syntax error)
- **422 Unprocessable Entity** - Valid request but validation failed

### Q: Should I always return 200 for success?

**A:** No. Use:

- **200** - GET, PUT, PATCH success
- **201** - POST success (resource created)
- **204** - DELETE success (no content)

---

## Related Topics

- [HTTP Methods](./02.%20HTTP%20Methods.md) - Which status codes for which methods
- [Error Handling](./07.%20Error%20Handling.md) - How to handle errors
- [REST API Principles](./06.%20REST%20API%20Principles.md) - RESTful status codes
- [HTTP Headers](./04.%20HTTP%20Headers.md) - Headers related to status codes

---

## Summary

**Status Code Ranges:**

- **2xx** - Success (200, 201, 204)
- **3xx** - Redirect (301, 302, 304)
- **4xx** - Client Error (400, 401, 403, 404, 422)
- **5xx** - Server Error (500, 502, 503)

**Key Status Codes:**

- **200** - OK (success)
- **201** - Created (POST success)
- **400** - Bad Request (invalid data)
- **401** - Unauthorized (not authenticated)
- **404** - Not Found (resource doesn't exist)
- **500** - Internal Server Error (server error)

**Best Practices:**

- Use appropriate status codes
- Include error details in responses
- Handle all status codes in client code
