# Authentication

Understanding HTTP authentication methods: Basic Auth, Bearer Token, API Keys, and OAuth 2.0 concepts.

---

## Core Concept

**Authentication** verifies who you are. **Authorization** determines what you can do.

**HTTP Authentication Methods:**

1. **Basic Authentication** - Username and password
2. **Bearer Token** - Token-based authentication
3. **API Keys** - Simple key-based authentication
4. **OAuth 2.0** - Delegated authentication

---

## Basic Authentication

### How It Works

**Basic Auth** sends username and password encoded in the Authorization header.

**Format:**

```
Authorization: Basic base64(username:password)
```

---

### Basic Auth Example

```javascript
// Encode credentials
const username = "user";
const password = "pass";
const credentials = btoa(`${username}:${password}`);

// Send request
fetch("/api/users", {
  headers: {
    Authorization: `Basic ${credentials}`,
  },
});
```

**Server receives:**

```
Authorization: Basic dXNlcjpwYXNz
```

**Server decodes:**

```
username:password
```

---

### Basic Auth Pros and Cons

**Pros:**

- ✅ Simple to implement
- ✅ Widely supported
- ✅ Built into HTTP

**Cons:**

- ❌ Credentials sent with every request
- ❌ Base64 encoding (not encryption)
- ❌ No expiration
- ❌ Not secure over HTTP (only HTTPS)

**Use Case:** Internal APIs, simple authentication

---

## Bearer Token Authentication

### How It Works

**Bearer Token** sends a token (usually JWT) in the Authorization header.

**Format:**

```
Authorization: Bearer <token>
```

---

### Bearer Token Example

```javascript
// Get token (from login, localStorage, etc.)
const token = localStorage.getItem("token");

// Send request
fetch("/api/users", {
  headers: {
    Authorization: `Bearer ${token}`,
  },
});
```

**Server receives:**

```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

---

### Token Flow

```
1. User logs in
   ↓
2. Server returns token
   ↓
3. Client stores token
   ↓
4. Client sends token with requests
   ↓
5. Server validates token
   ↓
6. Server responds
```

---

### Bearer Token Pros and Cons

**Pros:**

- ✅ Stateless (no server session)
- ✅ Can include user data (JWT)
- ✅ Can expire
- ✅ More secure than Basic Auth

**Cons:**

- ❌ Token can be stolen (XSS)
- ❌ No built-in revocation
- ❌ Token size (JWT can be large)

**Use Case:** Most modern APIs, SPAs, mobile apps

---

## API Key Authentication

### How It Works

**API Key** sends a simple key in header or query parameter.

**Format:**

```
X-API-Key: your-api-key
```

**Or query parameter:**

```
GET /api/users?api_key=your-api-key
```

---

### API Key Example

```javascript
// Header method (preferred)
fetch("/api/users", {
  headers: {
    "X-API-Key": "your-api-key-123",
  },
});

// Query parameter method
fetch("/api/users?api_key=your-api-key-123");
```

---

### API Key Pros and Cons

**Pros:**

- ✅ Simple
- ✅ Easy to implement
- ✅ Good for server-to-server

**Cons:**

- ❌ Key can be exposed (URLs logged)
- ❌ No expiration (unless managed)
- ❌ Less secure than tokens

**Use Case:** Server-to-server APIs, third-party integrations

---

## OAuth 2.0 Concepts

### What is OAuth 2.0?

**OAuth 2.0** is an authorization framework (not authentication, but often used for it).

**Key Concepts:**

- **Client** - Your application
- **Resource Owner** - User
- **Authorization Server** - Issues tokens
- **Resource Server** - API server

---

### OAuth 2.0 Flow (Simplified)

```
1. User clicks "Login with Google"
   ↓
2. Redirect to Google (Authorization Server)
   ↓
3. User authorizes your app
   ↓
4. Google redirects back with authorization code
   ↓
5. Your app exchanges code for access token
   ↓
6. Your app uses access token for API requests
```

---

### OAuth 2.0 Token Types

**Access Token:**

- Short-lived (hours/days)
- Used for API requests
- Sent in Authorization header

**Refresh Token:**

- Long-lived (weeks/months)
- Used to get new access tokens
- Stored securely

---

## Authentication Headers Comparison

| Method           | Header Format                   | Example                             |
| ---------------- | ------------------------------- | ----------------------------------- |
| **Basic Auth**   | `Authorization: Basic <base64>` | `Authorization: Basic dXNlcjpwYXNz` |
| **Bearer Token** | `Authorization: Bearer <token>` | `Authorization: Bearer eyJhbGc...`  |
| **API Key**      | `X-API-Key: <key>`              | `X-API-Key: abc123`                 |
| **Custom**       | `X-Auth-Token: <token>`         | `X-Auth-Token: token123`            |

---

## When to Use Each Method

### Basic Auth

✅ **Use for:**

- Internal APIs
- Simple authentication
- Legacy systems

❌ **Don't use for:**

- Public APIs
- User-facing applications
- Sensitive data

---

### Bearer Token

✅ **Use for:**

- Modern APIs
- SPAs (Single Page Apps)
- Mobile apps
- Most web applications

❌ **Don't use for:**

- Very simple APIs
- Server-to-server (API keys better)

---

### API Keys

✅ **Use for:**

- Server-to-server communication
- Third-party integrations
- Public APIs (with rate limiting)

❌ **Don't use for:**

- User authentication
- Browser-based apps (can be exposed)

---

### OAuth 2.0

✅ **Use for:**

- Third-party login (Google, Facebook)
- Delegated authorization
- Enterprise applications

❌ **Don't use for:**

- Simple authentication
- Internal-only APIs

---

## Security Best Practices

### 1. Always Use HTTPS

```javascript
// ❌ Bad - Credentials exposed
http://api.example.com/users

// ✅ Good - Encrypted
https://api.example.com/users
```

---

### 2. Store Tokens Securely

```javascript
// ❌ Bad - Stored in localStorage (vulnerable to XSS)
localStorage.setItem("token", token);

// ✅ Better - Use httpOnly cookies (server sets)
// Server sets cookie with HttpOnly flag

// ✅ Good - Use secure storage (mobile apps)
// Secure storage APIs
```

---

### 3. Include Token Expiration

```javascript
// ✅ Good - Check token expiration
if (tokenExpired(token)) {
  // Refresh token
  refreshToken();
}
```

---

### 4. Handle Token Refresh

```javascript
async function fetchWithAuth(url, options = {}) {
  let token = getToken();

  // Check if token expired
  if (isTokenExpired(token)) {
    token = await refreshToken();
  }

  const res = await fetch(url, {
    ...options,
    headers: {
      ...options.headers,
      Authorization: `Bearer ${token}`,
    },
  });

  // If token invalid, refresh and retry
  if (res.status === 401) {
    token = await refreshToken();
    return fetch(url, {
      ...options,
      headers: {
        ...options.headers,
        Authorization: `Bearer ${token}`,
      },
    });
  }

  return res;
}
```

---

## Common Authentication Patterns

### Pattern 1: Login Flow

```javascript
// 1. Login
const loginResponse = await fetch("/api/login", {
  method: "POST",
  body: JSON.stringify({ email, password }),
});

const { token, refreshToken } = await loginResponse.json();

// 2. Store tokens
localStorage.setItem("token", token);
localStorage.setItem("refreshToken", refreshToken);

// 3. Use token for requests
fetch("/api/users", {
  headers: {
    Authorization: `Bearer ${token}`,
  },
});
```

---

### Pattern 2: Token Refresh

```javascript
async function refreshAccessToken() {
  const refreshToken = localStorage.getItem("refreshToken");

  const res = await fetch("/api/refresh", {
    method: "POST",
    headers: {
      Authorization: `Bearer ${refreshToken}`,
    },
  });

  const { token } = await res.json();
  localStorage.setItem("token", token);
  return token;
}
```

---

### Pattern 3: Automatic Token Injection

```javascript
// Interceptor pattern (axios example)
axios.interceptors.request.use((config) => {
  const token = localStorage.getItem("token");
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});
```

---

## Common Questions

### Q: What's the difference between authentication and authorization?

**A:**

- **Authentication** - "Who are you?" (login)
- **Authorization** - "What can you do?" (permissions)

### Q: Should I use Basic Auth or Bearer Token?

**A:** Use Bearer Token for modern applications. Basic Auth is simpler but less secure.

### Q: Where should I store tokens?

**A:**

- **Browser:** httpOnly cookies (most secure) or memory
- **Mobile:** Secure storage APIs
- **Server:** Environment variables, secure vaults

### Q: How do I handle token expiration?

**A:** Check expiration before requests, refresh if expired, retry with new token if 401.

---

## Related Topics

- [HTTP Headers](./04.%20HTTP%20Headers.md) - Authorization header details
- [HTTP Status Codes](./03.%20HTTP%20Status%20Codes.md) - 401 Unauthorized, 403 Forbidden
- [Error Handling](./07.%20Error%20Handling.md) - Handling auth errors
- [HTTP Methods](./02.%20HTTP%20Methods.md) - Authentication with different methods
- [Authentication & Authorization](../7.%20Authentication%20&%20Authorization/index.md) - Detailed auth guide

---

## Summary

**Authentication Methods:**

- **Basic Auth** - Username/password (simple, less secure)
- **Bearer Token** - Token-based (modern, secure)
- **API Keys** - Key-based (server-to-server)
- **OAuth 2.0** - Delegated authorization

**Best Practices:**

- Always use HTTPS
- Store tokens securely
- Handle token expiration
- Implement token refresh

**Key Takeaway:** Bearer Token is the most common method for modern APIs. Use it unless you have specific requirements for other methods.
