# JWT vs Session-Based Authentication

Understanding the differences between JWT and session-based authentication - when to use each.

---

## Core Concept

Both JWT and session-based authentication solve the same problem: **keeping users authenticated across multiple requests**. But they do it differently.

**Key Difference:**

- **JWT** - Stateless (user data in token)
- **Session** - Stateful (user data on server)

---

## Quick Comparison

| Aspect           | JWT                          | Session-Based                 |
| ---------------- | ---------------------------- | ----------------------------- |
| **State**        | Stateless                    | Stateful                      |
| **User Data**    | In token (client)            | On server                     |
| **Storage**      | Client (localStorage/cookie) | Server (memory/database)      |
| **Verification** | Verify signature             | Lookup session                |
| **Scalability**  | Better (no server storage)   | Requires shared storage       |
| **Logout**       | Token valid until expiry     | Immediate (delete session)    |
| **Security**     | XSS risk (localStorage)      | More secure (HttpOnly cookie) |

---

## Detailed Differences

### 1. Where User Data is Stored

**JWT:**

- User data is **in the token itself**
- Token stored on client (localStorage, sessionStorage, cookie)
- Server doesn't store user data

**Session:**

- User data is **on the server**
- Cookie contains only session ID
- Server stores session data (memory/database)

---

### 2. How Verification Works

**JWT:**

```javascript
// Server verifies signature
jwt.verify(token, secretKey, (err, decoded) => {
  // decoded contains user data
  const userId = decoded.userId;
  const role = decoded.role;
});
```

**Session:**

```javascript
// Server looks up session
const session = await Session.findById(req.session.id);
const userId = session.userId;
const role = session.role;
```

---

### 3. Stateless vs Stateful

**JWT (Stateless):**

- Server doesn't store per-user data
- Only stores one secret key (constant)
- User data extracted from token
- No database lookup needed

**Session (Stateful):**

- Server stores per-user session data
- Must look up session for each request
- Cookie is just a pointer
- Requires database lookup

---

## When to Use JWT

✅ **Use JWT when:**

- Building microservices (stateless)
- Need scalability (no server storage)
- Mobile apps (tokens work well)
- Distributed systems (no shared storage needed)
- API-first applications

**Example Use Cases:**

- REST APIs
- Mobile apps
- Microservices architecture
- Single-page applications (SPAs)

---

## When to Use Session

✅ **Use Session when:**

- Traditional web applications
- Need immediate logout capability
- Security is critical (HttpOnly cookies)
- Server-side rendering (SSR)
- Simpler implementation

**Example Use Cases:**

- Traditional web apps
- Server-rendered applications
- Applications requiring immediate logout
- When security is top priority

---

## Security Comparison

### JWT Security Concerns

**XSS Vulnerability:**

```javascript
// ❌ Stored in localStorage - vulnerable to XSS
localStorage.setItem("token", token);

// Attacker can steal token via XSS
const stolenToken = localStorage.getItem("token");
```

**Solutions:**

- Use httpOnly cookies (but loses some stateless benefits)
- Implement proper XSS protection
- Use short expiration times
- Implement refresh tokens

---

### Session Security Advantages

**HttpOnly Cookies:**

```javascript
// ✅ Cookie not accessible via JavaScript
cookie: {
  httpOnly: true,  // Cannot be accessed via document.cookie
  secure: true,    // HTTPS only
  sameSite: 'strict'  // CSRF protection
}
```

**Benefits:**

- Protected from XSS (JavaScript can't access)
- Automatic CSRF protection
- More secure by default

---

## Scalability Comparison

### JWT Scalability

**Advantages:**

- No server storage needed
- Works across multiple servers
- No shared storage required
- Stateless = easier to scale

**Example:**

```
Server 1 → Verifies token → Works
Server 2 → Verifies token → Works (same secret key)
Server 3 → Verifies token → Works
```

---

### Session Scalability

**Challenges:**

- Requires shared storage (Redis, database)
- Must look up session for each request
- More complex to scale

**Example:**

```
Server 1 → Looks up session in Redis → Works
Server 2 → Looks up session in Redis → Works (shared storage)
Server 3 → Looks up session in Redis → Works
```

**Requires:** Shared Redis/database for all servers

---

## Logout Comparison

### JWT Logout

**Problem:** Token valid until expiry

```javascript
// ❌ Token still valid after "logout"
localStorage.removeItem("token"); // Removed from client
// But token still works if someone has it!
```

**Solutions:**

- Use short expiration times
- Implement token blacklist (defeats stateless benefit)
- Use refresh tokens

---

### Session Logout

**Advantage:** Immediate logout

```javascript
// ✅ Session deleted immediately
req.session.destroy();
// User logged out instantly
```

---

## Performance Comparison

### JWT Performance

**Advantages:**

- No database lookup
- Faster verification (just signature check)
- Less server load

**Disadvantages:**

- Larger token size (more data)
- More bandwidth per request

---

### Session Performance

**Advantages:**

- Smaller cookie (just session ID)
- Less bandwidth

**Disadvantages:**

- Database lookup for each request
- More server load
- Slower (depends on storage)

---

## Real-World Examples

### Example 1: REST API (Use JWT)

```javascript
// ✅ JWT better for APIs
// - Stateless
// - Works across servers
// - No shared storage needed

// Frontend
const token = localStorage.getItem("token");
fetch("/api/users", {
  headers: { Authorization: `Bearer ${token}` },
});

// Backend
jwt.verify(token, secretKey, (err, decoded) => {
  // No database lookup
});
```

---

### Example 2: Traditional Web App (Use Session)

```javascript
// ✅ Session better for web apps
// - More secure (HttpOnly cookies)
// - Immediate logout
// - Simpler for SSR

// Frontend
fetch("/api/users", {
  credentials: "include", // Cookie sent automatically
});

// Backend
if (req.session.userId) {
  // User authenticated
}
```

---

## Hybrid Approach

### JWT in HttpOnly Cookies

**Best of both worlds:**

```javascript
// Backend: Send JWT in HttpOnly cookie
res.cookie('token', jwtToken, {
  httpOnly: true,
  secure: true,
  sameSite: 'strict'
});

// Frontend: Cookie sent automatically
fetch('/api/users', {
  credentials: 'include'
});

// Backend: Extract from cookie
const token = req.cookies.token;
jwt.verify(token, secretKey, ...);
```

**Benefits:**

- JWT benefits (stateless)
- Session security (HttpOnly cookie)
- Best of both worlds

---

## Decision Matrix

### Choose JWT if:

- ✅ Building APIs
- ✅ Microservices architecture
- ✅ Need scalability
- ✅ Mobile apps
- ✅ Stateless is important

### Choose Session if:

- ✅ Traditional web apps
- ✅ Security is critical
- ✅ Need immediate logout
- ✅ Server-side rendering
- ✅ Simpler is better

---

## Common Questions

### Q: Can I use both?

**A:** Yes, but usually unnecessary. Choose one based on your needs.

### Q: Which is more secure?

**A:** Session (with HttpOnly cookies) is generally more secure against XSS. JWT in localStorage is vulnerable to XSS.

### Q: Which is faster?

**A:** JWT (no database lookup). But difference is usually negligible.

### Q: Can JWT be stateless if server stores secret key?

**A:** Yes. Secret key is constant (one for all tokens). Session data is per-user (different for each user). That's the difference.

---

## Related Topics

- [JWT Authentication](./01.%20JWT%20Authentication%20Workflow.md) - JWT details
- [Session-Based Authentication](./02.%20Session-Based%20Authentication.md) - Session details
- [Authentication vs Authorization](./index.md) - Concepts
- [HTTP Authentication](../01.%20HTTP/08.%20Authentication.md) - HTTP-level auth

---

## Summary

**JWT:**

- ✅ Stateless (user data in token)
- ✅ Better scalability
- ✅ No server storage
- ❌ XSS vulnerability (localStorage)
- ❌ Logout not immediate

**Session:**

- ✅ Stateful (user data on server)
- ✅ More secure (HttpOnly cookies)
- ✅ Immediate logout
- ❌ Requires shared storage
- ❌ Database lookup per request

**Key Difference:**

- **JWT:** User data in token → Stateless
- **Session:** User data on server → Stateful

**Choose based on:**

- APIs/Microservices → JWT
- Traditional web apps → Session
- Security critical → Session
- Scalability critical → JWT
