# IndexedDB

Understanding IndexedDB - a low-level API for storing large amounts of structured data.

---

## Core Concept

**IndexedDB** is a low-level API for storing large amounts of structured data (including files/blobs) in the browser.

**Key Characteristics:**

- ✅ Stores large amounts of data (~50% of disk space)
- ✅ Stores structured data (objects, arrays, files)
- ✅ Asynchronous API (non-blocking)
- ✅ Indexed for fast queries
- ✅ Transaction-based
- ⚠️ More complex than localStorage

---

## When to Use IndexedDB

✅ **Use IndexedDB for:**

- Large amounts of structured data
- Files and blobs
- Complex queries and indexing
- Offline-first applications
- Data that exceeds localStorage limits

❌ **Don't use IndexedDB for:**

- Simple key-value storage (use localStorage)
- Small amounts of data
- Simple use cases

---

## Basic Concepts

### Database

- **Database** - Container for object stores
- **Object Store** - Like a table in a database
- **Index** - For fast queries
- **Transaction** - Ensures data consistency

---

## Opening a Database

```javascript
// Open database
const request = indexedDB.open("myDatabase", 1);

// Success
request.onsuccess = (event) => {
  const db = event.target.result;
  console.log("Database opened:", db);
};

// Error
request.onerror = (event) => {
  console.error("Database error:", event.target.error);
};

// Upgrade needed (schema changes)
request.onupgradeneeded = (event) => {
  const db = event.target.result;

  // Create object store
  const objectStore = db.createObjectStore("users", { keyPath: "id" });

  // Create index
  objectStore.createIndex("name", "name", { unique: false });
};
```

---

## Creating Object Stores

```javascript
request.onupgradeneeded = (event) => {
  const db = event.target.result;

  // Create object store with keyPath
  const userStore = db.createObjectStore("users", { keyPath: "id" });

  // Create index
  userStore.createIndex("name", "name", { unique: false });
  userStore.createIndex("email", "email", { unique: true });
};
```

---

## Adding Data

```javascript
const db = request.result;

// Start transaction
const transaction = db.transaction(["users"], "readwrite");
const store = transaction.objectStore("users");

// Add data
const user = { id: 1, name: "John", email: "john@example.com" };
const addRequest = store.add(user);

addRequest.onsuccess = () => {
  console.log("User added");
};

addRequest.onerror = () => {
  console.error("Error adding user");
};
```

---

## Reading Data

```javascript
const db = request.result;
const transaction = db.transaction(["users"], "readonly");
const store = transaction.objectStore("users");

// Get by key
const getRequest = store.get(1);

getRequest.onsuccess = () => {
  const user = getRequest.result;
  console.log("User:", user);
};
```

---

## Updating Data

```javascript
const db = request.result;
const transaction = db.transaction(["users"], "readwrite");
const store = transaction.objectStore("users");

// Update data
const user = { id: 1, name: "John Updated", email: "john@example.com" };
const putRequest = store.put(user);

putRequest.onsuccess = () => {
  console.log("User updated");
};
```

---

## Deleting Data

```javascript
const db = request.result;
const transaction = db.transaction(["users"], "readwrite");
const store = transaction.objectStore("users");

// Delete by key
const deleteRequest = store.delete(1);

deleteRequest.onsuccess = () => {
  console.log("User deleted");
};
```

---

## Querying with Indexes

```javascript
const db = request.result;
const transaction = db.transaction(["users"], "readonly");
const store = transaction.objectStore("users");
const index = store.index("name");

// Get all users with name 'John'
const getRequest = index.getAll("John");

getRequest.onsuccess = () => {
  const users = getRequest.result;
  console.log("Users named John:", users);
};
```

---

## Complete Example

```javascript
// Open database
const request = indexedDB.open("myApp", 1);

request.onupgradeneeded = (event) => {
  const db = event.target.result;

  // Create object store
  const objectStore = db.createObjectStore("users", {
    keyPath: "id",
    autoIncrement: true,
  });

  // Create indexes
  objectStore.createIndex("name", "name", { unique: false });
  objectStore.createIndex("email", "email", { unique: true });
};

request.onsuccess = (event) => {
  const db = event.target.result;

  // Add user
  const transaction = db.transaction(["users"], "readwrite");
  const store = transaction.objectStore("users");

  const user = {
    name: "John",
    email: "john@example.com",
    age: 30,
  };

  const addRequest = store.add(user);

  addRequest.onsuccess = () => {
    console.log("User added with ID:", addRequest.result);

    // Read user
    const getRequest = store.get(addRequest.result);
    getRequest.onsuccess = () => {
      console.log("User:", getRequest.result);
    };
  };
};
```

---

## IndexedDB vs localStorage

| Feature        | IndexedDB              | localStorage     |
| -------------- | ---------------------- | ---------------- |
| **Size Limit** | ~50% disk              | ~5-10MB          |
| **Data Types** | Objects, arrays, files | Strings only     |
| **API**        | Asynchronous           | Synchronous      |
| **Queries**    | Indexed queries        | Key-value only   |
| **Complexity** | High                   | Low              |
| **Use Case**   | Large structured data  | Simple key-value |

---

## Common Questions

### Q: When should I use IndexedDB vs localStorage?

**A:** Use IndexedDB for large amounts of structured data or files. Use localStorage for simple key-value storage.

### Q: Is IndexedDB synchronous or asynchronous?

**A:** Asynchronous - all operations return requests that fire events.

### Q: Can I store files in IndexedDB?

**A:** Yes, IndexedDB can store Blobs and Files.

---

## Related Topics

- [localStorage and sessionStorage](./1.%20localStorage%20and%20sessionStorage.md) - Simple storage
- [Storage Comparison](./4.%20Storage%20Comparison.md) - Compare all storage types
- [Browser Storage Mechanisms](../../../../../../19.%20Browser%20Internals/18.%20Browser%20Storage%20Mechanisms.md) - How browsers store IndexedDB internally

---

## Summary

**IndexedDB:**

- ✅ Large storage capacity (~50% disk)
- ✅ Stores structured data (objects, files)
- ✅ Asynchronous API
- ✅ Indexed for fast queries
- ⚠️ More complex than localStorage

**Use for:**

- Large amounts of data
- Complex queries
- Offline-first apps
- Files and blobs

