# Global Error Handlers

Global error handlers catch errors that aren't handled by try-catch blocks. They're essential for production applications to prevent crashes and log errors.

---

## Why Global Error Handlers?

- **Uncaught errors** - Errors that escape try-catch blocks
- **Unhandled promise rejections** - Promise errors without `.catch()`
- **Production logging** - Log errors to monitoring services
- **Graceful degradation** - Prevent application crashes

---

## Browser: `window.onerror`

Handles uncaught JavaScript errors in the browser.

### Basic Usage

```javascript
window.onerror = function (message, source, lineno, colno, error) {
  console.log("Error:", message);
  console.log("Source:", source);
  console.log("Line:", lineno);
  console.log("Column:", colno);
  console.log("Error object:", error);

  // Return true to prevent default error handling
  return true;
};

// Trigger an error
undefinedVariable; // Caught by window.onerror
```

### Parameters

- **`message`** - Error message (string)
- **`source`** - URL of the script where error occurred
- **`lineno`** - Line number where error occurred
- **`colno`** - Column number where error occurred
- **`error`** - Error object (may be undefined in older browsers)

### Modern Approach: `window.addEventListener('error')`

```javascript
window.addEventListener("error", (event) => {
  console.error("Global error:", {
    message: event.message,
    source: event.filename,
    line: event.lineno,
    column: event.colno,
    error: event.error,
  });

  // Send to error logging service
  logErrorToService(event.error);

  // Prevent default browser error handling
  event.preventDefault();
});
```

---

## Browser: Unhandled Promise Rejections

Handles unhandled promise rejections.

### `unhandledrejection` Event

```javascript
window.addEventListener("unhandledrejection", (event) => {
  console.error("Unhandled promise rejection:", event.reason);

  // Log to error service
  logErrorToService(event.reason);

  // Prevent default console error
  event.preventDefault();
});

// Unhandled rejection
Promise.reject("Something went wrong"); // Caught by handler
```

### Example: Comprehensive Handler

```javascript
window.addEventListener("unhandledrejection", (event) => {
  const error = event.reason;

  // Log error details
  console.error("Unhandled Promise Rejection:", {
    message: error?.message || error,
    stack: error?.stack,
    timestamp: new Date().toISOString(),
  });

  // Send to monitoring service
  if (error instanceof Error) {
    sendToErrorService({
      type: "unhandled_rejection",
      message: error.message,
      stack: error.stack,
    });
  }

  // Prevent default handling
  event.preventDefault();
});
```

---

## Node.js: `process.on('uncaughtException')`

Handles uncaught exceptions in Node.js.

### Basic Usage

```javascript
process.on("uncaughtException", (error) => {
  console.error("Uncaught Exception:", error);

  // Log to file/service
  logError(error);

  // Exit process (recommended)
  process.exit(1);
});
```

### Important Notes

- **Process will crash** if uncaught exception occurs
- **Always exit** after logging (process is in undefined state)
- **Don't try to continue** - process is corrupted

```javascript
process.on("uncaughtException", (error) => {
  console.error("Fatal error:", error);

  // Log error
  logger.error(error);

  // Cleanup resources
  cleanup();

  // Exit gracefully
  process.exit(1);
});
```

---

## Node.js: `process.on('unhandledRejection')`

Handles unhandled promise rejections in Node.js.

### Basic Usage

```javascript
process.on("unhandledRejection", (reason, promise) => {
  console.error("Unhandled Rejection at:", promise);
  console.error("Reason:", reason);

  // Log error
  logger.error({ promise, reason });

  // Exit or handle appropriately
  process.exit(1);
});
```

### Modern Approach (Node.js 15+)

In Node.js 15+, unhandled rejections cause the process to exit. Handle them properly:

```javascript
// Handle all promise rejections
process.on("unhandledRejection", (reason, promise) => {
  console.error("Unhandled Rejection:", reason);
  // Log and exit
  process.exit(1);
});

// Or use async/await with try-catch
async function main() {
  try {
    await asyncOperation();
  } catch (error) {
    // Handle error properly
    console.error(error);
    process.exit(1);
  }
}
```

---

## Production Error Handling Setup

### Browser Setup

```javascript
// Global error handler
window.addEventListener("error", (event) => {
  const errorInfo = {
    message: event.message,
    source: event.filename,
    line: event.lineno,
    column: event.colno,
    stack: event.error?.stack,
    userAgent: navigator.userAgent,
    url: window.location.href,
    timestamp: new Date().toISOString(),
  };

  // Send to error monitoring service
  sendToErrorService(errorInfo);

  // Show user-friendly message
  showUserFriendlyError();

  event.preventDefault();
});

// Unhandled promise rejection handler
window.addEventListener("unhandledrejection", (event) => {
  const errorInfo = {
    type: "unhandled_rejection",
    reason: event.reason?.message || event.reason,
    stack: event.reason?.stack,
    timestamp: new Date().toISOString(),
  };

  sendToErrorService(errorInfo);
  event.preventDefault();
});
```

### Node.js Setup

```javascript
// Uncaught exception handler
process.on("uncaughtException", (error) => {
  logger.error("Uncaught Exception:", {
    message: error.message,
    stack: error.stack,
    timestamp: new Date().toISOString(),
  });

  // Send to monitoring service
  sendToErrorService(error);

  // Cleanup and exit
  cleanup();
  process.exit(1);
});

// Unhandled rejection handler
process.on("unhandledRejection", (reason, promise) => {
  logger.error("Unhandled Rejection:", {
    reason: reason?.message || reason,
    stack: reason?.stack,
    timestamp: new Date().toISOString(),
  });

  sendToErrorService({ reason, promise });
  process.exit(1);
});
```

---

## Error Monitoring Services

### Popular Services

- **Sentry** - Error tracking and monitoring
- **LogRocket** - Session replay and error tracking
- **Rollbar** - Real-time error tracking
- **Bugsnag** - Error monitoring and reporting

### Example: Sentry Integration

```javascript
// Initialize Sentry
Sentry.init({
  dsn: "your-sentry-dsn",
  environment: "production",
});

// Global error handler
window.addEventListener("error", (event) => {
  Sentry.captureException(event.error);
});

// Unhandled rejection handler
window.addEventListener("unhandledrejection", (event) => {
  Sentry.captureException(event.reason);
});
```

---

## Best Practices

### ✅ Do

- Always set up global error handlers in production
- Log errors to monitoring services
- Show user-friendly error messages
- Exit Node.js processes after uncaught exceptions
- Handle promise rejections properly

### ❌ Don't

- Don't ignore unhandled errors
- Don't continue execution after uncaught exceptions (Node.js)
- Don't expose sensitive error details to users
- Don't forget to handle promise rejections

---

## Related Topics

- [2. Errors in javascript.md](./2.%20Errors%20in%20javascript.md) - Error basics
- [4. Async Error Handling.md](./4.%20Async%20Error%20Handling.md) - Promise error handling
- [11. Production Error Handling.md](./10.%20Production%20Error%20Handling.md) - Production strategies
